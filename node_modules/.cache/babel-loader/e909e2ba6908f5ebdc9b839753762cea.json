{"ast":null,"code":"/**\n * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license\n */\nimport { first } from 'ckeditor5/src/utils';\n/**\n * @module image/imagestyle/converters\n */\n\n/**\n * Returns a converter for the `imageStyle` attribute. It can be used for adding, changing and removing the attribute.\n *\n * @param {Array.<module:image/imagestyle~ImageStyleOptionDefinition>} styles\n * An array containing available image style options.\n * @returns {Function} A model-to-view attribute converter.\n */\n\nexport function modelToViewStyleAttribute(styles) {\n  return (evt, data, conversionApi) => {\n    if (!conversionApi.consumable.consume(data.item, evt.name)) {\n      return;\n    } // Check if there is class name associated with given value.\n\n\n    const newStyle = getStyleDefinitionByName(data.attributeNewValue, styles);\n    const oldStyle = getStyleDefinitionByName(data.attributeOldValue, styles);\n    const viewElement = conversionApi.mapper.toViewElement(data.item);\n    const viewWriter = conversionApi.writer;\n\n    if (oldStyle) {\n      viewWriter.removeClass(oldStyle.className, viewElement);\n    }\n\n    if (newStyle) {\n      viewWriter.addClass(newStyle.className, viewElement);\n    }\n  };\n}\n/**\n * Returns a view-to-model converter converting image CSS classes to a proper value in the model.\n *\n * @param {Array.<module:image/imagestyle~ImageStyleOptionDefinition>} styles\n * Image style options for which the converter is created.\n * @returns {Function} A view-to-model converter.\n */\n\nexport function viewToModelStyleAttribute(styles) {\n  // Convert only non–default styles.\n  const nonDefaultStyles = {\n    imageInline: styles.filter(style => !style.isDefault && style.modelElements.includes('imageInline')),\n    imageBlock: styles.filter(style => !style.isDefault && style.modelElements.includes('imageBlock'))\n  };\n  return (evt, data, conversionApi) => {\n    if (!data.modelRange) {\n      return;\n    }\n\n    const viewElement = data.viewItem;\n    const modelImageElement = first(data.modelRange.getItems()); // Run this converter only if an image has been found in the model.\n    // In some cases it may not be found (for example if we run this on a figure with different type than image).\n\n    if (!modelImageElement) {\n      return;\n    } // ...and the `imageStyle` attribute is allowed for that element, otherwise stop conversion early.\n\n\n    if (!conversionApi.schema.checkAttribute(modelImageElement, 'imageStyle')) {\n      return;\n    } // Convert styles one by one.\n\n\n    for (const style of nonDefaultStyles[modelImageElement.name]) {\n      // Try to consume class corresponding with the style.\n      if (conversionApi.consumable.consume(viewElement, {\n        classes: style.className\n      })) {\n        // And convert this style to model attribute.\n        conversionApi.writer.setAttribute('imageStyle', style.name, modelImageElement);\n      }\n    }\n  };\n} // Returns the style with a given `name` from an array of styles.\n//\n// @param {String} name\n// @param {Array.<module:image/imagestyle~ImageStyleOptionDefinition> } styles\n// @returns {module:image/imagestyle~ImageStyleOptionDefinition|undefined}\n\nfunction getStyleDefinitionByName(name, styles) {\n  for (const style of styles) {\n    if (style.name === name) {\n      return style;\n    }\n  }\n}","map":{"version":3,"sources":["/Users/oyejin/Surfee/kiwi/node_modules/@ckeditor/ckeditor5-image/src/imagestyle/converters.js"],"names":["first","modelToViewStyleAttribute","styles","evt","data","conversionApi","consumable","consume","item","name","newStyle","getStyleDefinitionByName","attributeNewValue","oldStyle","attributeOldValue","viewElement","mapper","toViewElement","viewWriter","writer","removeClass","className","addClass","viewToModelStyleAttribute","nonDefaultStyles","imageInline","filter","style","isDefault","modelElements","includes","imageBlock","modelRange","viewItem","modelImageElement","getItems","schema","checkAttribute","classes","setAttribute"],"mappings":"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","sourcesContent":["/**\n * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.\n * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license\n */\n\nimport { first } from 'ckeditor5/src/utils';\n\n/**\n * @module image/imagestyle/converters\n */\n\n/**\n * Returns a converter for the `imageStyle` attribute. It can be used for adding, changing and removing the attribute.\n *\n * @param {Array.<module:image/imagestyle~ImageStyleOptionDefinition>} styles\n * An array containing available image style options.\n * @returns {Function} A model-to-view attribute converter.\n */\nexport function modelToViewStyleAttribute( styles ) {\n\treturn ( evt, data, conversionApi ) => {\n\t\tif ( !conversionApi.consumable.consume( data.item, evt.name ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Check if there is class name associated with given value.\n\t\tconst newStyle = getStyleDefinitionByName( data.attributeNewValue, styles );\n\t\tconst oldStyle = getStyleDefinitionByName( data.attributeOldValue, styles );\n\n\t\tconst viewElement = conversionApi.mapper.toViewElement( data.item );\n\t\tconst viewWriter = conversionApi.writer;\n\n\t\tif ( oldStyle ) {\n\t\t\tviewWriter.removeClass( oldStyle.className, viewElement );\n\t\t}\n\n\t\tif ( newStyle ) {\n\t\t\tviewWriter.addClass( newStyle.className, viewElement );\n\t\t}\n\t};\n}\n\n/**\n * Returns a view-to-model converter converting image CSS classes to a proper value in the model.\n *\n * @param {Array.<module:image/imagestyle~ImageStyleOptionDefinition>} styles\n * Image style options for which the converter is created.\n * @returns {Function} A view-to-model converter.\n */\nexport function viewToModelStyleAttribute( styles ) {\n\t// Convert only non–default styles.\n\tconst nonDefaultStyles = {\n\t\timageInline: styles.filter( style => !style.isDefault && style.modelElements.includes( 'imageInline' ) ),\n\t\timageBlock: styles.filter( style => !style.isDefault && style.modelElements.includes( 'imageBlock' ) )\n\t};\n\n\treturn ( evt, data, conversionApi ) => {\n\t\tif ( !data.modelRange ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst viewElement = data.viewItem;\n\t\tconst modelImageElement = first( data.modelRange.getItems() );\n\n\t\t// Run this converter only if an image has been found in the model.\n\t\t// In some cases it may not be found (for example if we run this on a figure with different type than image).\n\t\tif ( !modelImageElement ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// ...and the `imageStyle` attribute is allowed for that element, otherwise stop conversion early.\n\t\tif ( !conversionApi.schema.checkAttribute( modelImageElement, 'imageStyle' ) ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Convert styles one by one.\n\t\tfor ( const style of nonDefaultStyles[ modelImageElement.name ] ) {\n\t\t\t// Try to consume class corresponding with the style.\n\t\t\tif ( conversionApi.consumable.consume( viewElement, { classes: style.className } ) ) {\n\t\t\t\t// And convert this style to model attribute.\n\t\t\t\tconversionApi.writer.setAttribute( 'imageStyle', style.name, modelImageElement );\n\t\t\t}\n\t\t}\n\t};\n}\n\n// Returns the style with a given `name` from an array of styles.\n//\n// @param {String} name\n// @param {Array.<module:image/imagestyle~ImageStyleOptionDefinition> } styles\n// @returns {module:image/imagestyle~ImageStyleOptionDefinition|undefined}\nfunction getStyleDefinitionByName( name, styles ) {\n\tfor ( const style of styles ) {\n\t\tif ( style.name === name ) {\n\t\t\treturn style;\n\t\t}\n\t}\n}\n"]},"metadata":{},"sourceType":"module"}